---
title: SwiftUI 中的布局方式
date: 2025-07-24 10:00:00
permalink: /docs/swift/02.SwiftUI中的布局方式/
categories:
  - Swift
  - iOS
---

# SwiftUI中的布局方式

SwiftUI提供了多种布局容器来帮助开发者创建灵活且响应式的用户界面。本文将详细介绍SwiftUI中的主要布局方式，包括基础的Stack布局、网格布局以及它们的懒加载版本。

## 目录

1. [基础Stack布局](#基础stack布局)
   - [VStack - 垂直布局](#vstack---垂直布局)
   - [HStack - 水平布局](#hstack---水平布局)
   - [ZStack - 层叠布局](#zstack---层叠布局)
2. [懒加载Stack布局](#懒加载stack布局)
   - [LazyVStack](#lazyvstack)
   - [LazyHStack](#lazyhstack)
3. [网格布局](#网格布局)
   - [LazyVGrid - 垂直网格](#lazyvgrid---垂直网格)
   - [LazyHGrid - 水平网格](#lazyhgrid---水平网格)
   - [GridItem配置](#griditem配置)
4. [布局选择指南](#布局选择指南)
5. [最佳实践](#最佳实践)

## 基础Stack布局

### VStack - 垂直布局

VStack将子视图垂直排列，是最常用的布局容器之一。

```swift
struct VStackExample: View {
    var body: some View {
        VStack(alignment: .leading, spacing: 10) {
            Text("标题")
                .font(.headline)
            Text("这是一段描述文字")
                .font(.body)
            Button("点击按钮") {
                // 按钮动作
            }
        }
        .padding()
    }
}
```

**参数说明：**
- `alignment`: 对齐方式（.leading, .center, .trailing）
- `spacing`: 子视图间距

### HStack - 水平布局

HStack将子视图水平排列，适用于创建导航栏、工具栏等横向布局。

```swift
struct HStackExample: View {
    var body: some View {
        HStack(alignment: .center, spacing: 15) {
            Image(systemName: "person.circle")
                .font(.title)
            VStack(alignment: .leading) {
                Text("用户名")
                    .font(.headline)
                Text("用户描述")
                    .font(.caption)
                    .foregroundColor(.gray)
            }
            Spacer()
            Button("关注") {
                // 关注动作
            }
        }
        .padding()
    }
}
```

**关键点：**
- 使用`Spacer()`可以将视图推向两端
- `alignment`控制垂直对齐方式

### ZStack - 层叠布局

ZStack将子视图层叠在一起，适用于创建覆盖效果、徽章、背景等。

```swift
struct ZStackExample: View {
    var body: some View {
        ZStack(alignment: .topTrailing) {
            // 背景图片
            Image("profile")
                .resizable()
                .aspectRatio(contentMode: .fit)
                .frame(width: 100, height: 100)
                .clipShape(Circle())
            
            // 徽章
            Circle()
                .fill(Color.red)
                .frame(width: 20, height: 20)
                .overlay(
                    Text("3")
                        .font(.caption)
                        .foregroundColor(.white)
                )
                .offset(x: 5, y: -5)
        }
    }
}
```

## 懒加载Stack布局

### LazyVStack

LazyVStack是VStack的懒加载版本，只有当视图即将显示时才会创建，适用于长列表场景。

```swift
struct LazyVStackExample: View {
    let items = Array(1...1000)
    
    var body: some View {
        ScrollView {
            LazyVStack(spacing: 10) {
                ForEach(items, id: \.self) { item in
                    HStack {
                        Text("项目 \(item)")
                        Spacer()
                        Text("详情")
                            .foregroundColor(.gray)
                    }
                    .padding()
                    .background(Color.gray.opacity(0.1))
                    .cornerRadius(8)
                    .onAppear {
                        print("项目 \(item) 出现")
                    }
                }
            }
            .padding()
        }
    }
}
```

### LazyHStack

LazyHStack是HStack的懒加载版本，适用于水平滚动的长列表。

```swift
struct LazyHStackExample: View {
    let items = Array(1...50)
    
    var body: some View {
        ScrollView(.horizontal, showsIndicators: false) {
            LazyHStack(spacing: 15) {
                ForEach(items, id: \.self) { item in
                    VStack {
                        Image(systemName: "\(item).circle.fill")
                            .font(.largeTitle)
                            .foregroundColor(.blue)
                        Text("项目\(item)")
                            .font(.caption)
                    }
                    .frame(width: 80)
                }
            }
            .padding()
        }
    }
}
```

## 网格布局

### LazyVGrid - 垂直网格

LazyVGrid创建垂直滚动的网格布局，通过`columns`参数定义列的配置。

```swift
struct LazyVGridExample: View {
    let items = Array(1...50)
    
    // 定义网格列
    let columns = [
        GridItem(.flexible()),
        GridItem(.flexible()),
        GridItem(.flexible())
    ]
    
    var body: some View {
        ScrollView {
            LazyVGrid(columns: columns, spacing: 20) {
                ForEach(items, id: \.self) { item in
                    VStack {
                        RoundedRectangle(cornerRadius: 10)
                            .fill(Color.blue.opacity(0.3))
                            .frame(height: 80)
                            .overlay(
                                Text("\(item)")
                                    .font(.title2)
                                    .fontWeight(.bold)
                            )
                        Text("项目 \(item)")
                            .font(.caption)
                    }
                }
            }
            .padding()
        }
    }
}
```

### LazyHGrid - 水平网格

LazyHGrid创建水平滚动的网格布局，通过`rows`参数定义行的配置。

```swift
struct LazyHGridExample: View {
    let items = Array(1...30)
    
    // 定义网格行
    let rows = [
        GridItem(.fixed(60)),
        GridItem(.fixed(60))
    ]
    
    var body: some View {
        ScrollView(.horizontal) {
            LazyHGrid(rows: rows, spacing: 20) {
                ForEach(items, id: \.self) { item in
                    RoundedRectangle(cornerRadius: 8)
                        .fill(Color.green.opacity(0.3))
                        .frame(width: 100)
                        .overlay(
                            Text("\(item)")
                                .font(.headline)
                        )
                }
            }
            .padding()
        }
        .frame(height: 200)
    }
}
```

### GridItem配置

GridItem提供了三种尺寸配置方式：

```swift
// 1. 固定尺寸
GridItem(.fixed(100))  // 固定100点宽度

// 2. 灵活尺寸
GridItem(.flexible())  // 平均分配可用空间
GridItem(.flexible(minimum: 50, maximum: 200))  // 带最小最大值限制

// 3. 自适应尺寸
GridItem(.adaptive(minimum: 80))  // 根据最小尺寸自动计算列数
GridItem(.adaptive(minimum: 80, maximum: 120))  // 带最大值限制
```

**实际应用示例：**

```swift
struct GridItemExample: View {
    let photos = Array(1...20)
    
    var body: some View {
        ScrollView {
            LazyVGrid(columns: [
                GridItem(.adaptive(minimum: 100, maximum: 150))
            ], spacing: 10) {
                ForEach(photos, id: \.self) { photo in
                    Image(systemName: "photo")
                        .font(.system(size: 40))
                        .frame(maxWidth: .infinity, minHeight: 100)
                        .background(Color.gray.opacity(0.2))
                        .cornerRadius(8)
                }
            }
            .padding()
        }
    }
}
```

## 布局选择指南

### 何时使用VStack/HStack/ZStack

- **VStack**: 垂直排列少量视图（≤10个）
- **HStack**: 水平排列少量视图（≤10个）
- **ZStack**: 需要层叠效果时使用

### 何时使用LazyVStack/LazyHStack

- 数据量大（>50项）的滚动列表
- 需要优化内存使用的场景
- 视图创建成本较高的情况

### 何时使用LazyVGrid/LazyHGrid

- 需要网格布局的场景
- 照片墙、商品展示等
- 需要响应式列数的布局

## 最佳实践

### 1. 性能优化

```swift
// ✅ 推荐：大数据量使用懒加载
ScrollView {
    LazyVStack {
        ForEach(largeDataSet, id: \.id) { item in
            ItemView(item: item)
        }
    }
}

// ❌ 避免：大数据量使用普通Stack
ScrollView {
    VStack {
        ForEach(largeDataSet, id: \.id) { item in
            ItemView(item: item)  // 所有视图会立即创建
        }
    }
}
```

### 2. 响应式设计

```swift
struct ResponsiveGrid: View {
    @Environment(\.horizontalSizeClass) var sizeClass
    
    var columns: [GridItem] {
        if sizeClass == .compact {
            return [GridItem(.adaptive(minimum: 150))]  // 手机：较少列数
        } else {
            return [GridItem(.adaptive(minimum: 200))]  // 平板：较多列数
        }
    }
    
    var body: some View {
        LazyVGrid(columns: columns) {
            // 网格内容
        }
    }
}
```

### 3. 组合布局

```swift
struct ProfileView: View {
    var body: some View {
        VStack(spacing: 20) {
            // 头部信息
            HStack {
                Image("avatar")
                    .resizable()
                    .frame(width: 60, height: 60)
                    .clipShape(Circle())
                
                VStack(alignment: .leading) {
                    Text("用户名")
                        .font(.headline)
                    Text("个人简介")
                        .font(.caption)
                        .foregroundColor(.gray)
                }
                
                Spacer()
            }
            
            // 照片网格
            LazyVGrid(columns: [
                GridItem(.flexible()),
                GridItem(.flexible()),
                GridItem(.flexible())
            ]) {
                ForEach(photos, id: \.id) { photo in
                    PhotoView(photo: photo)
                }
            }
        }
        .padding()
    }
}
```

### 4. 内存管理

```swift
// 使用onAppear和onDisappear管理资源
LazyVStack {
    ForEach(items, id: \.id) { item in
        ItemView(item: item)
            .onAppear {
                // 加载数据或资源
                loadItemData(item)
            }
            .onDisappear {
                // 清理资源
                cleanupItemData(item)
            }
    }
}
```

## 总结

SwiftUI的布局系统提供了从简单到复杂的多种选择：

1. **基础Stack**: 适用于简单、静态的布局
2. **懒加载Stack**: 适用于大数据量的滚动列表
3. **网格布局**: 适用于需要网格结构的复杂布局

选择合适的布局方式不仅能提升用户体验，还能优化应用性能。在实际开发中，通常需要组合使用多种布局方式来实现复杂的界面设计。

记住：**优先考虑自适应布局，避免硬编码尺寸，合理使用懒加载来优化性能。**