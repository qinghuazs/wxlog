---
title: ControlNet å…¥é—¨ä¸åº”ç”¨
date: 2025-01-15
permalink: /ai/ai-art-stablediffusion/controlnet-guide.html
tags:
  - Stable Diffusion
  - ControlNet
  - AIç»˜ç”»
  - å›¾åƒæ§åˆ¶
categories:
  - AIç»˜ç”»
  - Stable Diffusionæ•™ç¨‹
---

# ControlNet å…¥é—¨ä¸åº”ç”¨

## ğŸ“š æœ¬ç« æ¦‚è¿°

ControlNet æ˜¯ Stable Diffusion ç”Ÿæ€ä¸­æœ€é‡è¦çš„æ§åˆ¶å·¥å…·ä¹‹ä¸€ï¼Œå®ƒèƒ½å¤Ÿç²¾ç¡®æ§åˆ¶ç”Ÿæˆå›¾åƒçš„å§¿åŠ¿ã€æ„å›¾ã€è¾¹ç¼˜ç­‰ç‰¹å¾ã€‚æœ¬ç« å°†å…¨é¢ä»‹ç» ControlNet çš„åŸç†ã€å®‰è£…é…ç½®ä»¥åŠå„ç§é¢„å¤„ç†å™¨çš„å®é™…åº”ç”¨ã€‚

## 1. ControlNet åŸºç¡€æ¦‚å¿µ

### 1.1 ä»€ä¹ˆæ˜¯ ControlNet

ControlNet æ˜¯ä¸€ç§ç¥ç»ç½‘ç»œæ¶æ„ï¼Œé€šè¿‡æ·»åŠ é¢å¤–çš„æ§åˆ¶æ¡ä»¶æ¥å¼•å¯¼ Stable Diffusion çš„ç”Ÿæˆè¿‡ç¨‹ã€‚

```mermaid
graph LR
    A[ControlNet<br/>å·¥ä½œåŸç†] --> B[è¾“å…¥å±‚]
    A --> C[å¤„ç†å±‚]
    A --> D[è¾“å‡ºå±‚]

    subgraph è¾“å…¥å¤„ç†
        B --> B1[åŸå§‹å›¾åƒ]
        B --> B2[é¢„å¤„ç†å™¨]
        B --> B3[æ§åˆ¶ä¿¡å·]
    end

    subgraph æ¨¡å‹èåˆ
        C --> C1[é”å®šSDå‚æ•°]
        C --> C2[å¯è®­ç»ƒå‰¯æœ¬]
        C --> C3[é›¶å·ç§¯å±‚]
    end

    subgraph ç”Ÿæˆæ§åˆ¶
        D --> D1[å§¿æ€æ§åˆ¶]
        D --> D2[è¾¹ç¼˜æ§åˆ¶]
        D --> D3[æ·±åº¦æ§åˆ¶]
    end

    style A fill:#e1f5fe,stroke:#333
    style B fill:#fff3e0,stroke:#333
    style C fill:#f3e5f5,stroke:#333
    style D fill:#e8f5e9,stroke:#333
```

### 1.2 æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ | åº”ç”¨åœºæ™¯ |
|------|------|----------|
| **ç²¾ç¡®æ§åˆ¶** | å¯ä»¥ç²¾ç¡®æ§åˆ¶äººç‰©å§¿åŠ¿ã€æ„å›¾å¸ƒå±€ | å•†ä¸šæ‘„å½±ã€è§’è‰²è®¾è®¡ |
| **é£æ ¼ä¿æŒ** | åœ¨æ”¹å˜å†…å®¹çš„åŒæ—¶ä¿æŒè‰ºæœ¯é£æ ¼ | é£æ ¼è¿ç§»ã€äºŒæ¬¡åˆ›ä½œ |
| **ç»†èŠ‚ä¿ç•™** | ä¿ç•™åŸå›¾å…³é”®ç‰¹å¾å’Œç»†èŠ‚ | å›¾åƒä¿®å¤ã€å¢å¼º |
| **å¤šæ¨¡æ€èåˆ** | æ”¯æŒå¤šç§æ§åˆ¶æ¡ä»¶ç»„åˆä½¿ç”¨ | å¤æ‚åœºæ™¯ç”Ÿæˆ |
| **çµæ´»æƒé‡** | å¯è°ƒèŠ‚æ§åˆ¶å¼ºåº¦å®ç°è‡ªç„¶è¿‡æ¸¡ | åˆ›æ„æ¢ç´¢ã€å¾®è°ƒ |

### 1.3 ControlNet ä¸ä¼ ç»Ÿæ–¹æ³•å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿ img2img | ControlNet |
|------|-------------|------------|
| æ§åˆ¶ç²¾åº¦ | ä½ï¼Œä¾èµ–é™å™ªå¼ºåº¦ | é«˜ï¼Œç²¾ç¡®åˆ°åƒç´ çº§ |
| å§¿åŠ¿æ§åˆ¶ | æ— æ³•å®ç° | å®Œç¾æ”¯æŒ |
| æ„å›¾ä¿æŒ | éƒ¨åˆ†ä¿æŒ | ç²¾ç¡®ä¿æŒ |
| å¤šæ¡ä»¶ç»„åˆ | ä¸æ”¯æŒ | æ”¯æŒå¤šç§ç»„åˆ |
| å­¦ä¹ æˆæœ¬ | ä½ | ä¸­ç­‰ |

## 2. å®‰è£…ä¸é…ç½®

### 2.1 å®‰è£… ControlNet æ‰©å±•

```mermaid
graph LR
    A[å®‰è£…æµç¨‹] --> B[æ‰©å±•å®‰è£…]
    A --> C[æ¨¡å‹ä¸‹è½½]
    A --> D[é…ç½®ä¼˜åŒ–]

    subgraph æ‰©å±•å®‰è£…
        B --> B1[ä»URLå®‰è£…]
        B --> B2[æ‰‹åŠ¨å®‰è£…]
        B --> B3[é‡å¯WebUI]
    end

    subgraph æ¨¡å‹è·å–
        C --> C1[å®˜æ–¹æ¨¡å‹]
        C --> C2[ç¤¾åŒºæ¨¡å‹]
        C --> C3[é¢„å¤„ç†å™¨]
    end

    subgraph æ€§èƒ½è®¾ç½®
        D --> D1[æ˜¾å­˜ä¼˜åŒ–]
        D --> D2[é¢„å¤„ç†ç¼“å­˜]
        D --> D3[å¤šControlNet]
    end

    style A fill:#e1f5fe,stroke:#333
    style B fill:#c8e6c9,stroke:#333
    style C fill:#fff9c4,stroke:#333
    style D fill:#f8bbd9,stroke:#333
```

**æ–¹æ³•ä¸€ï¼šä» URL å®‰è£…ï¼ˆæ¨èï¼‰**

1. æ‰“å¼€ WebUI â†’ Extensions â†’ Install from URL
2. è¾“å…¥ä»“åº“åœ°å€ï¼š
```
https://github.com/Mikubill/sd-webui-controlnet
```
3. ç‚¹å‡» Install â†’ ç­‰å¾…å®Œæˆ â†’ é‡å¯ WebUI

**æ–¹æ³•äºŒï¼šæ‰‹åŠ¨å®‰è£…**

```bash
# è¿›å…¥æ‰©å±•ç›®å½•
cd stable-diffusion-webui/extensions

# å…‹éš†ä»“åº“
git clone https://github.com/Mikubill/sd-webui-controlnet

# é‡å¯ WebUI
```

### 2.2 ä¸‹è½½ ControlNet æ¨¡å‹

**æ¨¡å‹å­˜æ”¾è·¯å¾„ï¼š**
```
stable-diffusion-webui/
â”œâ”€â”€ extensions/
â”‚   â””â”€â”€ sd-webui-controlnet/
â””â”€â”€ models/
    â””â”€â”€ ControlNet/          # ControlNet æ¨¡å‹å­˜æ”¾ä½ç½®
        â”œâ”€â”€ control_v11p_sd15_canny.pth
        â”œâ”€â”€ control_v11p_sd15_openpose.pth
        â””â”€â”€ ...
```

**æ¨èä¸‹è½½æ¨¡å‹ï¼š**

| æ¨¡å‹åç§° | æ–‡ä»¶å¤§å° | ç”¨é€” | ä¼˜å…ˆçº§ |
|----------|----------|------|--------|
| canny | ~1.4GB | è¾¹ç¼˜æ£€æµ‹æ§åˆ¶ | â­â­â­â­â­ |
| openpose | ~1.4GB | äººä½“å§¿åŠ¿æ§åˆ¶ | â­â­â­â­â­ |
| depth | ~1.4GB | æ·±åº¦å›¾æ§åˆ¶ | â­â­â­â­ |
| lineart | ~1.4GB | çº¿ç¨¿ä¸Šè‰² | â­â­â­â­ |
| scribble | ~1.4GB | æ¶‚é¸¦è½¬å›¾ | â­â­â­ |
| softedge | ~1.4GB | æŸ”å’Œè¾¹ç¼˜ | â­â­â­ |
| tile | ~1.4GB | ç»†èŠ‚å¢å¼º | â­â­â­â­ |
| ip-adapter | ~50MB | é£æ ¼è¿ç§» | â­â­â­â­â­ |

**ä¸‹è½½åœ°å€ï¼š**
- HuggingFace: https://huggingface.co/lllyasviel/ControlNet-v1-1
- å›½å†…é•œåƒ: https://hf-mirror.com/lllyasviel/ControlNet-v1-1

### 2.3 æ˜¾å­˜ä¼˜åŒ–é…ç½®

```python
# åœ¨ webui-user.bat æˆ–å¯åŠ¨è„šæœ¬ä¸­æ·»åŠ 

# ä½æ˜¾å­˜ä¼˜åŒ–ï¼ˆ6GBä»¥ä¸‹ï¼‰
set COMMANDLINE_ARGS=--medvram --xformers

# æä½æ˜¾å­˜ï¼ˆ4GBï¼‰
set COMMANDLINE_ARGS=--lowvram --xformers

# å¤š ControlNet è®¾ç½®ï¼ˆSettings â†’ ControlNetï¼‰
# Multi ControlNet: Max models amount = 3
```

**æ˜¾å­˜å ç”¨å‚è€ƒï¼š**

| é…ç½® | å•ä¸ª ControlNet | åŒ ControlNet | ä¸‰ ControlNet |
|------|----------------|---------------|---------------|
| 512Ã—512 | +1.5GB | +2.5GB | +3.5GB |
| 768Ã—768 | +2.5GB | +4GB | +5.5GB |
| 1024Ã—1024 | +4GB | +6GB | +8GB |

## 3. é¢„å¤„ç†å™¨è¯¦è§£

### 3.1 é¢„å¤„ç†å™¨åˆ†ç±»

```mermaid
graph LR
    A[é¢„å¤„ç†å™¨<br/>åˆ†ç±»] --> B[è¾¹ç¼˜æ£€æµ‹]
    A --> C[äººä½“æ£€æµ‹]
    A --> D[æ·±åº¦æ£€æµ‹]
    A --> E[è¯­ä¹‰åˆ†å‰²]
    A --> F[å…¶ä»–]

    subgraph è¾¹ç¼˜ç±»
        B --> B1[Canny]
        B --> B2[Lineart]
        B --> B3[Softedge]
        B --> B4[Scribble]
    end

    subgraph äººä½“ç±»
        C --> C1[OpenPose]
        C --> C2[MediaPipe Face]
        C --> C3[DW Pose]
    end

    subgraph æ·±åº¦ç±»
        D --> D1[Depth Midas]
        D --> D2[Depth Zoe]
        D --> D3[Normal Map]
    end

    subgraph åˆ†å‰²ç±»
        E --> E1[Segmentation]
        E --> E2[Shuffle]
    end

    subgraph ç‰¹æ®Šç±»
        F --> F1[Tile]
        F --> F2[Inpaint]
        F --> F3[Reference]
    end

    style A fill:#e1f5fe,stroke:#333
    style B fill:#ffcdd2,stroke:#333
    style C fill:#c8e6c9,stroke:#333
    style D fill:#fff9c4,stroke:#333
    style E fill:#e1bee7,stroke:#333
    style F fill:#b3e5fc,stroke:#333
```

### 3.2 Canny è¾¹ç¼˜æ£€æµ‹

**åŸç†è¯´æ˜ï¼š**
Canny è¾¹ç¼˜æ£€æµ‹å™¨é€šè¿‡å¤šé˜¶æ®µç®—æ³•æ£€æµ‹å›¾åƒä¸­çš„è¾¹ç¼˜ï¼Œè¾“å‡ºäºŒå€¼è¾¹ç¼˜å›¾ã€‚

**å‚æ•°è®¾ç½®ï¼š**

| å‚æ•° | æ¨èå€¼ | è¯´æ˜ |
|------|--------|------|
| Low Threshold | 100 | è¾¹ç¼˜æ£€æµ‹ä½é˜ˆå€¼ |
| High Threshold | 200 | è¾¹ç¼˜æ£€æµ‹é«˜é˜ˆå€¼ |
| Control Weight | 1.0 | æ§åˆ¶å¼ºåº¦ |
| Starting Step | 0 | å¼€å§‹æ§åˆ¶çš„æ­¥æ•° |
| Ending Step | 1.0 | ç»“æŸæ§åˆ¶çš„æ­¥æ•°æ¯”ä¾‹ |

**ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… å»ºç­‘ç‰©è½¬ç»˜
- âœ… æœºæ¢°/äº§å“è®¾è®¡
- âœ… Logo/å›¾æ ‡è½¬ç»˜
- âœ… çº¿ç¨¿ä¸Šè‰²
- âŒ äººåƒï¼ˆè¾¹ç¼˜è¿‡ç¡¬ï¼‰

**æœ€ä½³å®è·µï¼š**
```
æ­£å‘æç¤ºè¯ï¼šmasterpiece, best quality, [æè¿°å†…å®¹]
è´Ÿå‘æç¤ºè¯ï¼šlowres, bad anatomy, worst quality

å‚æ•°å»ºè®®ï¼š
- Sampling: DPM++ 2M Karras
- Steps: 25-30
- CFG: 7-9
- Control Weight: 0.8-1.0
```

### 3.3 OpenPose å§¿åŠ¿æ£€æµ‹

**æ£€æµ‹å†…å®¹ï¼š**

```mermaid
graph LR
    A[OpenPose<br/>æ£€æµ‹ç±»å‹] --> B[èº«ä½“å…³é”®ç‚¹]
    A --> C[é¢éƒ¨å…³é”®ç‚¹]
    A --> D[æ‰‹éƒ¨å…³é”®ç‚¹]

    subgraph èº«ä½“éª¨æ¶
        B --> B1[18ä¸ªå…³é”®ç‚¹]
        B --> B2[èº«ä½“å§¿æ€]
        B --> B3[è‚¢ä½“ä½ç½®]
    end

    subgraph é¢éƒ¨ç»†èŠ‚
        C --> C1[68ä¸ªå…³é”®ç‚¹]
        C --> C2[è¡¨æƒ…ç‰¹å¾]
        C --> C3[é¢éƒ¨æœå‘]
    end

    subgraph æ‰‹éƒ¨ç»†èŠ‚
        D --> D1[21ä¸ªå…³é”®ç‚¹/æ‰‹]
        D --> D2[æ‰‹æŒ‡å§¿æ€]
        D --> D3[æ‰‹åŠ¿è¯†åˆ«]
    end

    style A fill:#e8f5e9,stroke:#333
    style B fill:#fff3e0,stroke:#333
    style C fill:#fce4ec,stroke:#333
    style D fill:#e3f2fd,stroke:#333
```

**é¢„å¤„ç†å™¨é€‰é¡¹ï¼š**

| é¢„å¤„ç†å™¨ | æ£€æµ‹å†…å®¹ | ç²¾åº¦ | é€Ÿåº¦ |
|----------|----------|------|------|
| openpose | èº«ä½“ | ä¸­ | å¿« |
| openpose_face | èº«ä½“+é¢éƒ¨ | é«˜ | ä¸­ |
| openpose_hand | èº«ä½“+æ‰‹éƒ¨ | é«˜ | ä¸­ |
| openpose_full | å…¨éƒ¨ | æœ€é«˜ | æ…¢ |
| dw_openpose_full | å…¨éƒ¨ï¼ˆæ”¹è¿›ç‰ˆï¼‰ | æœ€é«˜ | ä¸­ |

**ä½¿ç”¨æŠ€å·§ï¼š**

1. **å•äººåœºæ™¯**ï¼šä½¿ç”¨ `openpose_full` è·å–æœ€ä½³æ•ˆæœ
2. **å¤šäººåœºæ™¯**ï¼šå…ˆæ£€æµ‹å†æ‰‹åŠ¨è°ƒæ•´é®æŒ¡éƒ¨åˆ†
3. **æ‰‹éƒ¨é—®é¢˜**ï¼šé…åˆæ‰‹éƒ¨ä¿®å¤LoRAä½¿ç”¨
4. **é¢éƒ¨æœå‘**ï¼šç¡®ä¿é¢éƒ¨æ¸…æ™°å¯è§

### 3.4 Depth æ·±åº¦æ£€æµ‹

**æ·±åº¦æ£€æµ‹å™¨å¯¹æ¯”ï¼š**

| æ£€æµ‹å™¨ | ç²¾åº¦ | é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|--------|------|------|----------|
| depth_midas | é«˜ | ä¸­ | é€šç”¨åœºæ™¯ |
| depth_zoe | æœ€é«˜ | æ…¢ | å®¤å†…åœºæ™¯ |
| depth_leres | é«˜ | æ…¢ | è¿œæ™¯åœºæ™¯ |
| depth_leres++ | æœ€é«˜ | æœ€æ…¢ | é«˜ç²¾åº¦éœ€æ±‚ |

**åº”ç”¨åœºæ™¯ï¼š**
- ğŸï¸ æ™¯æ·±æ§åˆ¶
- ğŸ  å®¤å†…è®¾è®¡
- ğŸ® æ¸¸æˆåœºæ™¯
- ğŸ“¸ å‰åæ™¯åˆ†ç¦»

### 3.5 Lineart çº¿ç¨¿å¤„ç†

**çº¿ç¨¿é¢„å¤„ç†å™¨å¯¹æ¯”ï¼š**

| é¢„å¤„ç†å™¨ | çº¿æ¡é£æ ¼ | é€‚ç”¨å†…å®¹ |
|----------|----------|----------|
| lineart_realistic | å†™å®ç»†è…» | äººåƒã€é£æ™¯ |
| lineart_coarse | ç²—çŠ·æœ‰åŠ› | æ¼«ç”»ã€æ’ç”» |
| lineart_anime | åŠ¨æ¼«é£æ ¼ | äºŒæ¬¡å…ƒè§’è‰² |
| lineart_anime_denoise | å»å™ªåŠ¨æ¼« | ä½è´¨é‡çº¿ç¨¿ |

**çº¿ç¨¿ä¸Šè‰²æµç¨‹ï¼š**

```mermaid
graph LR
    A[çº¿ç¨¿ä¸Šè‰²<br/>æµç¨‹] --> B[å‡†å¤‡é˜¶æ®µ]
    A --> C[å¤„ç†é˜¶æ®µ]
    A --> D[ä¼˜åŒ–é˜¶æ®µ]

    subgraph ç´ æå‡†å¤‡
        B --> B1[æ¸…ç†çº¿ç¨¿]
        B --> B2[è°ƒæ•´å¯¹æ¯”åº¦]
        B --> B3[ç»Ÿä¸€å°ºå¯¸]
    end

    subgraph ä¸Šè‰²å¤„ç†
        C --> C1[é€‰æ‹©é¢„å¤„ç†å™¨]
        C --> C2[è®¾ç½®æƒé‡]
        C --> C3[ç¼–å†™æç¤ºè¯]
    end

    subgraph æ•ˆæœä¼˜åŒ–
        D --> D1[è°ƒæ•´é¥±å’Œåº¦]
        D --> D2[ä¿®å¤æº¢è‰²]
        D --> D3[ç»†èŠ‚å¢å¼º]
    end

    style A fill:#fff3e0,stroke:#333
    style B fill:#e8f5e9,stroke:#333
    style C fill:#e3f2fd,stroke:#333
    style D fill:#fce4ec,stroke:#333
```

### 3.6 Tile ç»†èŠ‚å¢å¼º

**Tile æ¨¡å‹ç‰¹ç‚¹ï¼š**
- æ”¾å¤§å›¾åƒåŒæ—¶å¢å¼ºç»†èŠ‚
- ä¿æŒåŸå›¾æ•´ä½“é£æ ¼
- ä¿®å¤æ¨¡ç³ŠåŒºåŸŸ
- æ·»åŠ åˆç†çº¹ç†

**ä½¿ç”¨åœºæ™¯ï¼š**
| åœºæ™¯ | è®¾ç½®å»ºè®® |
|------|----------|
| å›¾åƒæ”¾å¤§ | Weight: 0.5-0.7, Denoise: 0.3-0.5 |
| ç»†èŠ‚å¢å¼º | Weight: 0.8-1.0, Denoise: 0.2-0.4 |
| é£æ ¼ç»Ÿä¸€ | Weight: 0.6-0.8, Denoise: 0.4-0.6 |

### 3.7 Reference å‚è€ƒæ§åˆ¶

**Reference æ¨¡å¼ï¼š**

| æ¨¡å¼ | æ•ˆæœ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| reference_only | ä»…å‚è€ƒé£æ ¼ | é£æ ¼è¿ç§» |
| reference_adain | è‡ªé€‚åº”é£æ ¼ | è‰²è°ƒç»Ÿä¸€ |
| reference_adain+attn | ç»¼åˆå‚è€ƒ | è§’è‰²ä¸€è‡´æ€§ |

## 4. å®æˆ˜åº”ç”¨æ¡ˆä¾‹

### 4.1 äººç‰©å§¿åŠ¿æ§åˆ¶

**æ¡ˆä¾‹ï¼šæ ¹æ®å‚è€ƒå›¾ç”Ÿæˆç‰¹å®šå§¿åŠ¿äººç‰©**

```
è¾“å…¥ï¼šå¸¦æœ‰ç‰¹å®šå§¿åŠ¿çš„å‚è€ƒå›¾
ç›®æ ‡ï¼šç”Ÿæˆç›¸åŒå§¿åŠ¿çš„ä¸åŒé£æ ¼äººç‰©

ControlNet è®¾ç½®ï¼š
â”œâ”€â”€ é¢„å¤„ç†å™¨: dw_openpose_full
â”œâ”€â”€ æ¨¡å‹: control_v11p_sd15_openpose
â”œâ”€â”€ Control Weight: 0.9
â”œâ”€â”€ Starting Step: 0
â””â”€â”€ Ending Step: 1

æç¤ºè¯ï¼š
æ­£å‘: masterpiece, best quality, 1girl, beautiful face,
      detailed eyes, flowing dress, standing pose
è´Ÿå‘: bad anatomy, wrong fingers, extra limbs,
      deformed, ugly, blurry
```

### 4.2 å»ºç­‘è½¬ç»˜

**æ¡ˆä¾‹ï¼šå°†ç…§ç‰‡è½¬æ¢ä¸ºæ’ç”»é£æ ¼**

```
è¾“å…¥ï¼šå»ºç­‘ç‰©ç…§ç‰‡
ç›®æ ‡ï¼šè½¬æ¢ä¸ºåŠ¨æ¼«/æ’ç”»é£æ ¼

ControlNet è®¾ç½®ï¼š
â”œâ”€â”€ é¢„å¤„ç†å™¨: canny (Threshold: 100-200)
â”œâ”€â”€ æ¨¡å‹: control_v11p_sd15_canny
â”œâ”€â”€ Control Weight: 0.8
â”œâ”€â”€ Starting Step: 0
â””â”€â”€ Ending Step: 0.8

æç¤ºè¯ï¼š
æ­£å‘: anime style, detailed background,
      beautiful architecture, makoto shinkai style,
      blue sky, clouds
è´Ÿå‘: realistic, photo, ugly, low quality
```

### 4.3 çº¿ç¨¿ä¸Šè‰²

**æ¡ˆä¾‹ï¼šé»‘ç™½çº¿ç¨¿è‡ªåŠ¨ä¸Šè‰²**

```
è¾“å…¥ï¼šåŠ¨æ¼«äººç‰©çº¿ç¨¿
ç›®æ ‡ï¼šé«˜è´¨é‡å½©è‰²æ’ç”»

ControlNet è®¾ç½®ï¼š
â”œâ”€â”€ é¢„å¤„ç†å™¨: lineart_anime
â”œâ”€â”€ æ¨¡å‹: control_v11p_sd15_lineart
â”œâ”€â”€ Control Weight: 1.0
â”œâ”€â”€ Starting Step: 0
â””â”€â”€ Ending Step: 1

æç¤ºè¯ï¼š
æ­£å‘: masterpiece, best quality, anime coloring,
      vibrant colors, detailed shading,
      [è§’è‰²æè¿°], [é¢œè‰²æè¿°]
è´Ÿå‘: grayscale, monochrome, sketch,
      bad coloring, flat colors
```

### 4.4 å¤š ControlNet ç»„åˆ

**æ¡ˆä¾‹ï¼šå§¿åŠ¿+æ·±åº¦åŒé‡æ§åˆ¶**

```mermaid
graph LR
    A[å¤šControlNet<br/>ç»„åˆç­–ç•¥] --> B[å§¿åŠ¿+æ·±åº¦]
    A --> C[è¾¹ç¼˜+çº¿ç¨¿]
    A --> D[å§¿åŠ¿+å‚è€ƒ]

    subgraph å§¿åŠ¿æ·±åº¦ç»„åˆ
        B --> B1[OpenPose: 0.8]
        B --> B2[Depth: 0.6]
        B --> B3[ç²¾ç¡®äººç‰©+åœºæ™¯]
    end

    subgraph è¾¹ç¼˜çº¿ç¨¿ç»„åˆ
        C --> C1[Canny: 0.7]
        C --> C2[Lineart: 0.5]
        C --> C3[ç»“æ„+ç»†èŠ‚]
    end

    subgraph å§¿åŠ¿å‚è€ƒç»„åˆ
        D --> D1[OpenPose: 0.9]
        D --> D2[Reference: 0.6]
        D --> D3[å§¿åŠ¿+é£æ ¼]
    end

    style A fill:#e1f5fe,stroke:#333
    style B fill:#c8e6c9,stroke:#333
    style C fill:#fff9c4,stroke:#333
    style D fill:#f8bbd9,stroke:#333
```

**ç»„åˆè®¾ç½®ç¤ºä¾‹ï¼š**

```
ControlNet Unit 0:
â”œâ”€â”€ é¢„å¤„ç†å™¨: dw_openpose_full
â”œâ”€â”€ æ¨¡å‹: openpose
â”œâ”€â”€ Weight: 0.85
â””â”€â”€ ä½œç”¨: æ§åˆ¶äººç‰©å§¿åŠ¿

ControlNet Unit 1:
â”œâ”€â”€ é¢„å¤„ç†å™¨: depth_midas
â”œâ”€â”€ æ¨¡å‹: depth
â”œâ”€â”€ Weight: 0.6
â””â”€â”€ ä½œç”¨: æ§åˆ¶ç©ºé—´æ·±åº¦

æ€»ä½“å‚æ•°ï¼š
â”œâ”€â”€ CFG Scale: 7
â”œâ”€â”€ Steps: 30
â””â”€â”€ Sampler: DPM++ 2M Karras
```

## 5. å‚æ•°è°ƒä¼˜æŒ‡å—

### 5.1 Control Weight å½±å“

| Weight å€¼ | æ•ˆæœ | é€‚ç”¨æƒ…å†µ |
|-----------|------|----------|
| 0.3-0.5 | è½»åº¦å‚è€ƒ | åˆ›æ„è‡ªç”±åº¦é«˜ |
| 0.6-0.8 | å¹³è¡¡æ§åˆ¶ | æ—¥å¸¸ä½¿ç”¨æ¨è |
| 0.9-1.0 | ä¸¥æ ¼éµå¾ª | ç²¾ç¡®å¤åˆ¶éœ€æ±‚ |
| 1.2+ | è¿‡åº¦æ§åˆ¶ | å¯èƒ½äº§ç”Ÿä¼ªå½± |

### 5.2 Starting/Ending Step

```
æ§åˆ¶æ—¶æœºè°ƒæ•´ï¼š

æ—©æœŸæ§åˆ¶ (0-0.5)ï¼š
â”œâ”€â”€ å½±å“æ•´ä½“æ„å›¾å’Œå¸ƒå±€
â”œâ”€â”€ å¯¹å¤§ä½“è½®å»“å½±å“å¤§
â””â”€â”€ æ¨èç”¨äºå§¿åŠ¿æ§åˆ¶

ä¸­æœŸæ§åˆ¶ (0.3-0.7)ï¼š
â”œâ”€â”€ å¹³è¡¡ç»“æ„ä¸ç»†èŠ‚
â”œâ”€â”€ é€‚åˆå¤§å¤šæ•°åœºæ™¯
â””â”€â”€ é»˜è®¤æ¨èè®¾ç½®

åæœŸæ§åˆ¶ (0.5-1.0)ï¼š
â”œâ”€â”€ ä¸»è¦å½±å“ç»†èŠ‚
â”œâ”€â”€ å¯¹æ•´ä½“å½±å“å°
â””â”€â”€ æ¨èç”¨äºç»†èŠ‚å¢å¼º
```

### 5.3 å¸¸è§é—®é¢˜è§£å†³

| é—®é¢˜ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| æ§åˆ¶æ•ˆæœå¼± | Weight è¿‡ä½ | æé«˜åˆ° 0.8-1.0 |
| å›¾åƒå¤±çœŸ | Weight è¿‡é«˜ | é™ä½åˆ° 0.6-0.8 |
| è¾¹ç¼˜ä¼ªå½± | é¢„å¤„ç†è´¨é‡å·® | è°ƒæ•´é¢„å¤„ç†å‚æ•° |
| å§¿åŠ¿ä¸å‡† | é®æŒ¡æˆ–å¤æ‚å§¿åŠ¿ | æ‰‹åŠ¨ç¼–è¾‘éª¨æ¶ |
| æ˜¾å­˜ä¸è¶³ | æ¨¡å‹è¿‡å¤š | å¯ç”¨ lowvram æ¨¡å¼ |

## 6. é«˜çº§æŠ€å·§

### 6.1 ControlNet è’™ç‰ˆ

```
è’™ç‰ˆåº”ç”¨åœºæ™¯ï¼š
â”œâ”€â”€ å±€éƒ¨æ§åˆ¶ï¼ˆåªæ§åˆ¶äººç‰©ï¼Œä¸æ§åˆ¶èƒŒæ™¯ï¼‰
â”œâ”€â”€ åŒºåŸŸæ··åˆï¼ˆä¸åŒåŒºåŸŸä½¿ç”¨ä¸åŒæ§åˆ¶ï¼‰
â””â”€â”€ ç²¾ç»†ä¿®å¤ï¼ˆä»…ä¿®å¤ç‰¹å®šåŒºåŸŸï¼‰

è’™ç‰ˆè®¾ç½®ï¼š
1. åœ¨ ControlNet é¢æ¿å¯ç”¨è’™ç‰ˆ
2. ä¸Šä¼ æˆ–ç»˜åˆ¶è’™ç‰ˆï¼ˆç™½è‰²=ç”Ÿæ•ˆåŒºåŸŸï¼‰
3. è°ƒæ•´ç¾½åŒ–å€¼å®ç°è‡ªç„¶è¿‡æ¸¡
```

### 6.2 Preprocessor å‚æ•°å¾®è°ƒ

**Canny å‚æ•°ä¼˜åŒ–ï¼š**
```
ä½é˜ˆå€¼ (Low Threshold)ï¼š
â”œâ”€â”€ ä½å€¼ (50-80): æ£€æµ‹æ›´å¤šç»†èŠ‚è¾¹ç¼˜
â”œâ”€â”€ ä¸­å€¼ (100-150): å¹³è¡¡æ•ˆæœ
â””â”€â”€ é«˜å€¼ (150-200): åªä¿ç•™ä¸»è¦è¾¹ç¼˜

é«˜é˜ˆå€¼ (High Threshold)ï¼š
â”œâ”€â”€ ä¸ä½é˜ˆå€¼å·®è·å°: è¾¹ç¼˜æ›´æ¸…æ™°ä½†å¯èƒ½æ–­è£‚
â””â”€â”€ ä¸ä½é˜ˆå€¼å·®è·å¤§: è¾¹ç¼˜è¿ç»­ä½†å¯èƒ½æœ‰å™ªç‚¹
```

### 6.3 IP-Adapter é£æ ¼è¿ç§»

```mermaid
graph LR
    A[IP-Adapter<br/>é£æ ¼è¿ç§»] --> B[æ¨¡å‹ç±»å‹]
    A --> C[ä½¿ç”¨æ–¹å¼]
    A --> D[æœ€ä½³å®è·µ]

    subgraph æ¨¡å‹é€‰æ‹©
        B --> B1[ip-adapter_sd15]
        B --> B2[ip-adapter_sd15_plus]
        B --> B3[ip-adapter-faceid]
    end

    subgraph åº”ç”¨åœºæ™¯
        C --> C1[é£æ ¼å‚è€ƒ]
        C --> C2[è§’è‰²ä¸€è‡´æ€§]
        C --> C3[é¢éƒ¨ä¿æŒ]
    end

    subgraph å‚æ•°å»ºè®®
        D --> D1[Weight: 0.5-0.8]
        D --> D2[é…åˆå…¶ä»–ControlNet]
        D --> D3[å¤šå›¾å‚è€ƒå¹³å‡]
    end

    style A fill:#e1f5fe,stroke:#333
    style B fill:#fff3e0,stroke:#333
    style C fill:#e8f5e9,stroke:#333
    style D fill:#f3e5f5,stroke:#333
```

## 7. å·¥ä½œæµç¨‹æ¨¡æ¿

### 7.1 äººç‰©åˆ›ä½œæµç¨‹

```
1. å‡†å¤‡é˜¶æ®µ
   â”œâ”€â”€ æ”¶é›†å‚è€ƒå§¿åŠ¿å›¾
   â”œâ”€â”€ ç¡®å®šç”»é¢é£æ ¼
   â””â”€â”€ å‡†å¤‡è§’è‰²æè¿°æç¤ºè¯

2. ControlNet é…ç½®
   â”œâ”€â”€ å¯ç”¨ OpenPose
   â”œâ”€â”€ ä¸Šä¼ å‚è€ƒå›¾å¹¶é¢„å¤„ç†
   â”œâ”€â”€ è®¾ç½® Weight: 0.85
   â””â”€â”€ å¯é€‰ï¼šæ·»åŠ  Reference æ§åˆ¶é£æ ¼

3. ç”Ÿæˆå‚æ•°
   â”œâ”€â”€ Sampler: DPM++ 2M Karras
   â”œâ”€â”€ Steps: 25-30
   â”œâ”€â”€ CFG: 7-8
   â””â”€â”€ å°ºå¯¸: 512x768 æˆ– 768x1024

4. è¿­ä»£ä¼˜åŒ–
   â”œâ”€â”€ ç”Ÿæˆå¤šå¼ é€‰æ‹©æœ€ä½³
   â”œâ”€â”€ è°ƒæ•´ Weight å¾®è°ƒæ•ˆæœ
   â””â”€â”€ ä½¿ç”¨ img2img å±€éƒ¨ä¿®å¤
```

### 7.2 å»ºç­‘/åœºæ™¯è½¬ç»˜æµç¨‹

```
1. ç´ æå‡†å¤‡
   â”œâ”€â”€ é€‰æ‹©æ¸…æ™°çš„å»ºç­‘ç…§ç‰‡
   â”œâ”€â”€ è°ƒæ•´å¯¹æ¯”åº¦å’Œäº®åº¦
   â””â”€â”€ ç¡®å®šç›®æ ‡é£æ ¼

2. ControlNet é…ç½®
   â”œâ”€â”€ ä¸»æ§åˆ¶: Canny (Weight: 0.8)
   â”œâ”€â”€ è¾…åŠ©: Depth (Weight: 0.5)
   â””â”€â”€ è°ƒæ•´ Canny é˜ˆå€¼çªå‡ºå»ºç­‘è½®å»“

3. é£æ ¼æç¤ºè¯
   â”œâ”€â”€ æ˜ç¡®è‰ºæœ¯é£æ ¼ï¼ˆå¦‚ Ghibliã€æ–°æµ·è¯šï¼‰
   â”œâ”€â”€ æ·»åŠ æ°›å›´æè¿°ï¼ˆå…‰çº¿ã€å¤©æ°”ï¼‰
   â””â”€â”€ æ’é™¤ä¸éœ€è¦çš„å…ƒç´ 

4. åæœŸå¤„ç†
   â”œâ”€â”€ ä½¿ç”¨ Tile æ”¾å¤§å¹¶å¢å¼ºç»†èŠ‚
   â”œâ”€â”€ è°ƒæ•´è‰²å½©é¥±å’Œåº¦
   â””â”€â”€ æ·»åŠ é¢å¤–ç‰¹æ•ˆ
```

## 8. æ€»ç»“ä¸å»ºè®®

### 8.1 ControlNet é€‰æ‹©é€ŸæŸ¥è¡¨

| éœ€æ±‚ | æ¨èæ–¹æ¡ˆ | å¤‡é€‰æ–¹æ¡ˆ |
|------|----------|----------|
| æ§åˆ¶äººç‰©å§¿åŠ¿ | OpenPose | DW Pose |
| ä¿æŒæ„å›¾ç»“æ„ | Canny | Lineart |
| æ§åˆ¶ç©ºé—´æ·±åº¦ | Depth | Normal |
| çº¿ç¨¿ä¸Šè‰² | Lineart | Scribble |
| é£æ ¼è¿ç§» | Reference/IP-Adapter | Shuffle |
| å›¾åƒæ”¾å¤§å¢å¼º | Tile | - |
| å±€éƒ¨é‡ç»˜ | Inpaint | - |

### 8.2 å­¦ä¹ è·¯å¾„å»ºè®®

```mermaid
graph LR
    A[ControlNet<br/>å­¦ä¹ è·¯å¾„] --> B[å…¥é—¨é˜¶æ®µ]
    A --> C[è¿›é˜¶é˜¶æ®µ]
    A --> D[é«˜çº§é˜¶æ®µ]

    subgraph åŸºç¡€æŒæ¡
        B --> B1[Cannyè¾¹ç¼˜]
        B --> B2[OpenPoseå§¿åŠ¿]
        B --> B3[å•ä¸€æ§åˆ¶]
    end

    subgraph æŠ€èƒ½æå‡
        C --> C1[Depth/Lineart]
        C --> C2[å¤šControlNetç»„åˆ]
        C --> C3[å‚æ•°ç²¾è°ƒ]
    end

    subgraph ä¸“ä¸šåº”ç”¨
        D --> D1[IP-Adapter]
        D --> D2[è‡ªå®šä¹‰å·¥ä½œæµ]
        D --> D3[æ‰¹é‡å¤„ç†]
    end

    style A fill:#e1f5fe,stroke:#333
    style B fill:#c8e6c9,stroke:#333
    style C fill:#fff9c4,stroke:#333
    style D fill:#f8bbd9,stroke:#333
```

---

**æœ¬ç« è¦ç‚¹å›é¡¾ï¼š**
- ControlNet æ˜¯ç²¾ç¡®æ§åˆ¶ SD ç”Ÿæˆçš„æ ¸å¿ƒå·¥å…·
- ä¸åŒé¢„å¤„ç†å™¨é€‚ç”¨äºä¸åŒåœºæ™¯
- åˆç†ç»„åˆå¤šä¸ª ControlNet å¯å®ç°å¤æ‚æ•ˆæœ
- å‚æ•°è°ƒä¼˜æ˜¯è·å¾—ç†æƒ³æ•ˆæœçš„å…³é”®
- å»ºç«‹æ ‡å‡†åŒ–å·¥ä½œæµç¨‹æé«˜æ•ˆç‡

**ä¸‹ä¸€ç« é¢„å‘Šï¼š** LoRA æ¨¡å‹ä½¿ç”¨ - å­¦ä¹ å¦‚ä½•ä½¿ç”¨å’Œå åŠ  LoRA å®ç°é£æ ¼å®šåˆ¶
